name: Build EtherEver1

# 언제 이 액션이 실행될지 정의합니다.
on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  build:
    name: Build and Test
    # 리눅스 환경(Ubuntu)에서 실행합니다.
    runs-on: ubuntu-latest

    steps:
    # 1. 저장소의 코드를 체크아웃(다운로드) 합니다.
    - name: Checkout code
      uses: actions/checkout@v4

    # 2. Go 언어 환경을 설정합니다.
    # 이더리움 최신 버전은 보통 Go 1.21 이상을 권장합니다.
    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: '1.22'
        cache: true

    # 3. 의존성 패키지를 다운로드합니다.
    - name: Get dependencies
      run: go mod download

    # 4. 전체 패키지를 빌드하여 컴파일 에러가 없는지 확인합니다.
    - name: Build all packages
      run: go build -v ./...

    # 5. (선택사항) 주요 실행 파일(cmd/geth)을 구체적으로 빌드해봅니다.
    # 포크 프로젝트의 이름이 바뀌었더라도 보통 구조는 cmd/geth 또는 cmd/ether-ever1 등에 있습니다.
    # 경로가 다르다면 이 부분은 수정이 필요할 수 있습니다.
    - name: Build main binary
      run: |
        if [ -d "./cmd/geth" ]; then
          go build -v ./cmd/geth
        else
          echo "Default cmd/geth directory not found, skipping binary specific build."
        fi

    # 6. 유닛 테스트를 실행합니다. (시간이 오래 걸리면 주석 처리 가능)
    - name: Run tests
      run: go test -v ./...
